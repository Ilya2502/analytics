(()=>{"use strict";var t;!function(t){t.Body=".body",t.AppWrapper=".app-wrapper",t.Button=".button",t.GetData=".get-data",t.AddMyProduct=".add-my-product",t.AddOtherProduct=".add-other-product",t.InputMyContainer=".input-my-container",t.InputOtherContainer=".input-other-container",t.InputCorrectContainer=".input-correct-container",t.MainButtonsContainer=".main-buttons-container",t.TableContainer=".table-container",t.ButtonInput=".button-input",t.WriteMyProduct=".write-my-product",t.WriteOtherProduct=".write-other-product",t.WriteCorrectProduct=".write-correct-product",t.EditLink=".edit-link",t.DeleteLink=".delete-link",t.MyUrl=".edit-link-my",t.MyInput=".my-input",t.OtherInput=".other-input",t.CorrectInput=".correct-input",t.ProductsContainer=".products-container",t.URLTable=".URL-table",t.Table=".table",t.ClearInput=".clear-input"}(t||(t={}));const e=t;var n=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function d(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,d)}c((r=r.apply(t,e||[])).next())}))};var r=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function d(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,d)}c((r=r.apply(t,e||[])).next())}))};(new class{constructor(){this.checkMainButton=t=>{t.currentTarget.classList.contains(e.AddMyProduct.slice(1))?this.view.showInput(e.InputMyContainer):this.view.showInput(e.InputOtherContainer)},this.checkButtonInput=t=>{const n=t.currentTarget;if(n.classList.contains(`${e.WriteCorrectProduct.slice(1)}`)){const t=this.view.getURL(e.CorrectInput);this.model.allProducts[this.table.model.numberCorrectProduct].model.properties.URL=t,this.updateProductAndRenderTable(e.InputCorrectContainer)}n.classList.contains(`${e.WriteMyProduct.slice(1)}`)?this.createProductAndRenderTable(e.InputMyContainer,e.MyInput,"my"):n.classList.contains(`${e.WriteOtherProduct.slice(1)}`)&&this.createProductAndRenderTable(e.InputOtherContainer,e.OtherInput,"other")},this.renderTable=(t,e)=>{this.table.createTable(e),this.table.addProducts(t)},this.removeProductAndRenderTable=t=>{if(this.model.removeProduct(t),0===this.model.allProducts.length)return document.querySelector(e.TableContainer).innerHTML="",void document.querySelector(e.GetData).classList.add("hidden");const n=this.model.getFullProductsProperties();this.renderTable(n,"Адрес")},this.getProductsAnalysis=()=>{return t=this,e=void 0,r=function*(){document.querySelectorAll(".face").forEach((t=>t.classList.add("animation-action"))),document.querySelector(".loader-container").classList.add("visible"),setTimeout(this.view.hideLoader,2e3);const t=this.model.getStartProductsProperties(),e=yield this.model.service.postURLAndGetData(t);if(null==e?void 0:e.length){this.model.clearProducts(),e.forEach((t=>{this.model.createProduct(t)}));const t=this.model.getFullProductsProperties();this.renderTable(t,"Параметр")}},new((n=void 0)||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function d(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,d)}c((r=r.apply(t,e||[])).next())}));var t,e,n,r},this.view=new class{constructor(){this.showInput=(t,n)=>{const r=document.querySelector(t),i=r.querySelector(".input-URL");i.value="",n&&(i.value=n),r.classList.remove("hidden"),i.focus(),document.querySelector(e.MainButtonsContainer).classList.add("hidden")},this.hideInput=t=>{document.querySelector(t).classList.add("hidden"),document.querySelector(e.MainButtonsContainer).classList.remove("hidden")}}renderMainPage(){document.querySelector(e.Body).innerHTML=this.mainPageStructure()}addMainButtonListener(t){document.querySelectorAll(`${e.AddMyProduct}, ${e.AddOtherProduct}`).forEach((e=>{e.addEventListener("click",t)}))}addButtonInputListener(t){document.querySelectorAll(e.ButtonInput).forEach((e=>{e.addEventListener("click",t)}))}getURL(t){return document.querySelector(t).value}hideLoader(){document.querySelector(".loader-container").classList.remove("visible"),document.querySelectorAll(".face").forEach((t=>t.classList.remove("animation-action")))}addClearInputListener(){document.querySelectorAll(e.ClearInput).forEach((t=>{t.addEventListener("click",(t=>{const e=t.target,n=document.querySelector(`\n        .${e.id.split("-").slice(1).join("-")}`);n.focus(),n.value=""}))}))}addGetDataButtonListener(t){document.querySelector(e.GetData).addEventListener("click",t)}mainPageStructure(){return'\n    <div class="app-wrapper">\n      <div class="loader-container">\n        <div class="loader">\n          <div class="face">\n            <div class="circle"></div>\n          </div>\n          <div class="face">\n            <div class="circle"></div>\n          </div>\n        </div>\n        <p class="loader-text">Обработка данных...</p>\n      </div>\n      <h1 class="main-title">Analytics studio</h1>\n      <div class="input-correct-container hidden">\n        <input type="text" class="input-URL correct-input" placeholder="Введите новый адрес продукта">\n        <div class="clear-input" id="clear-correct-input"></div>\n        <button class="button button-input write-correct-product">Изменить</button>\n      </div>\n      <div class="input-my-container hidden">\n        <input type="text" class="input-URL my-input" placeholder="Введите адрес своего продукта">\n        <div class="clear-input" id="clear-my-input"></div>\n        <button class="button button-input write-my-product">Записать</button>\n      </div>\n      <div class="input-other-container hidden">\n        <input type="text" class="input-URL other-input" placeholder="Введите адрес продукта для сравнения">\n        <div class="clear-input" id="clear-other-input"></div>\n        <button class="button button-input write-other-product">Записать</button>\n      </div>\n      <div class="main-buttons-container">\n        <button class="button add-my-product">Добавить свой продукт</button>\n        <button class="button add-other-product">Добавить продукт для сравнения</button>\n      </div>\n      <div class="table-container"></div>\n      <button class="button get-data hidden">Получить данные</button>\n    </div>\n    '}},this.model=new class{constructor(){this.removeProduct=t=>{this.myProducts.length&&t<this.myProducts.length?(this.myProducts.splice(t,1),this.allProducts=this.myProducts.concat(this.otherProducts)):(this.otherProducts.splice(t-this.myProducts.length,1),this.allProducts=this.myProducts.concat(this.otherProducts))},this.service=new class extends class{constructor(){this.baseUrl=""}typedFetch(t,e,r){return n(this,void 0,void 0,(function*(){try{const n=`${this.baseUrl}/${t}`,i=this.getRequestConfig(e,r),s=yield fetch(`${n}`,i);return yield s.json()}catch(t){return console.log("error",e),null}}))}getRequestConfig(t,e){const n={body:JSON.stringify(e),headers:{"Content-Type":"application/json"}};switch(t){case"GET":return Object.assign({method:"GET"},n);case"DELETE":return Object.assign({method:"DELETE"},n);case"POST":return Object.assign({method:"POST"},n);case"PUT":return Object.assign({method:"PUT"},n);default:return{}}}getData(t){return n(this,void 0,void 0,(function*(){return yield this.typedFetch(t,"GET")}))}postData(t,e){return n(this,void 0,void 0,(function*(){return yield this.typedFetch(t,"POST",e)}))}}{getProducts(t){return r(this,void 0,void 0,(function*(){const e=t;return yield this.getData(e)}))}postURLAndGetData(t){return r(this,void 0,void 0,(function*(){return t.map((t=>{const e=t;return e.changed="yes",e.title_symbols="54",e.desc="описание...",e.desc_symbols="1785",console.log(e),e})),console.log(t),t}))}},this.myProducts=[],this.otherProducts=[],this.allProducts=[]}createProduct(t){const n=new class{constructor(t){this.view=new class{renderURL(t,n){const r=document.querySelector(e.URLTable),i=document.createElement("tr");i.classList.add("tr-property");const s=document.createElement("td");s.innerHTML=`${n+1}`,i.append(s);const o=document.createElement("td");o.innerHTML=t.name,i.append(o);const d=document.createElement("td"),c=document.createElement("a");c.href=t.URL,c.innerHTML="URL",d.append(c),i.append(d);const a=this.renderEditLink(n);i.append(a),r.append(i)}renderEditLink(t){const e=document.createElement("div");return e.classList.add(`edit-link-${t}`,"edit-link"),e.title="Отредактировать адрес",e}},this.model=new class{constructor(t){this.properties=t}}(t)}}(t);"my"===t.owner?(n.model.properties.Имя=`Ваш продукт ${this.myProducts.length+1}`,this.myProducts.push(n),this.allProducts=this.myProducts.concat(this.otherProducts)):(n.model.properties.Имя=`Продукт для сравнения ${this.otherProducts.length+1}`,this.otherProducts.push(n),this.allProducts=this.myProducts.concat(this.otherProducts))}clearProducts(){this.myProducts=[],this.otherProducts=[],this.allProducts=[]}getFullProductsProperties(){return this.allProducts.map((t=>t.model.properties))}getStartProductsProperties(){return this.allProducts.map((t=>{const{URL:e,owner:n,Имя:r}=t.model.properties;return{URL:e,owner:n,Имя:r}}))}},this.table=new class{constructor(t,n,r){this.checkEditor=t=>{const n=t.currentTarget;this.model.numberCorrectProduct=+n.id.split("-").slice(-1);const{URL:r}=this.model.products[this.model.numberCorrectProduct];this.hideInput(e.InputOtherContainer),this.hideInput(e.InputMyContainer),this.showInput(e.InputCorrectContainer,r)},this.checkDelete=t=>{const n=t.currentTarget;this.model.numberCorrectProduct=+n.id.split("-").slice(-1),this.removeProductAndRenderTable(this.model.numberCorrectProduct),this.hideInput(e.InputOtherContainer),this.hideInput(e.InputMyContainer),this.hideInput(e.InputCorrectContainer)},this.view=new class{renderTable(t){const n=document.querySelector(e.TableContainer);n.innerHTML="",this.table=document.createElement("table"),this.table.classList.add("table"),this.tHead=document.createElement("thead"),this.tHead.classList.add("tHead"),this.tBody=document.createElement("tbody"),this.tBody.classList.add("tbody"),this.table.append(this.tHead),this.table.append(this.tBody),n.append(this.table),this.renderHeadProperty(t)}renderHeadProperty(t){this.tHeadRow=this.renderTR(),this.tHeadRow.classList.add("tHeadRow");const e=this.renderTH();e.classList.add("head-property"),e.innerHTML=t,this.tHeadRow.append(e),this.tHead.append(this.tHeadRow)}renderTH(){return document.createElement("th")}renderTR(){return document.createElement("tr")}renderTD(){return document.createElement("td")}renderTitleProducts(t){t.forEach(((t,e)=>{const n=this.renderTH();n.classList.add(`title-product-${t.owner}`);const r=this.renderLink(t,e);n.append(r);const i=this.renderEditLink(e,t.owner);n.append(i);const s=this.renderDeleteLink(e,t.owner);n.append(s),this.tHeadRow.append(n)}))}addEditListener(t){this.tHead.querySelectorAll(e.EditLink).forEach((e=>{e.addEventListener("click",t)}))}addDeleteListener(t){this.tHead.querySelectorAll(e.DeleteLink).forEach((e=>{e.addEventListener("click",t)}))}renderLink(t,e){const n=document.createElement("a");return n.classList.add(`URL-${e}`,"link-product"),n.href=t.URL,n.title=t.URL,n.innerHTML="URL",n}renderEditLink(t,e){const n=document.createElement("div");return n.classList.add("edit-link",`edit-link-${e}`),n.id=`edit-${t}`,n.title="Отредактировать адрес",n}renderDeleteLink(t,e){const n=document.createElement("div");return n.classList.add("delete-link",`delete-link-${e}`),n.id=`delete-${t}`,n.title="Удалить продукт",n}renderProducts(t){Object.keys(t[0]).filter((t=>"URL"!==t&&"owner"!==t)).forEach(((e,n)=>{this.renderPropertyKeys(e,n),t.forEach(((t,r)=>{this.renderPropertyValues(e,n,t,r)}))}))}renderPropertyKeys(t,e){const n=this.renderTR();n.classList.add(`tr-${e}`);const r=this.renderTH();r.classList.add("property-key"),r.innerHTML=t,n.append(r),this.tBody.append(n)}renderPropertyValues(t,n,r,i){const s=this.tBody.querySelector(`.tr-${n}`),o=this.renderTD();o.classList.add(`property-value-${r.owner}`),n%2!=0&&i>0&&o.classList.add("pale");const d=document.createElement("p");d.innerHTML=r[t],o.append(d),s.append(o),document.querySelector(e.GetData).classList.remove("hidden")}},this.model=new class{constructor(){this.products=[]}},this.showInput=t,this.hideInput=n,this.removeProductAndRenderTable=r}createTable(t){this.view.renderTable(t)}addProducts(t){this.model.products=t,this.view.renderTitleProducts(t),this.view.addEditListener(this.checkEditor),this.view.addDeleteListener(this.checkDelete),this.view.renderProducts(t)}}(this.view.showInput,this.view.hideInput,this.removeProductAndRenderTable)}initApp(){this.view.renderMainPage(),this.view.addMainButtonListener(this.checkMainButton),this.view.addButtonInputListener(this.checkButtonInput),this.view.addClearInputListener(),this.view.addGetDataButtonListener(this.getProductsAnalysis)}updateProductAndRenderTable(t){this.view.hideInput(t);const e=this.model.getStartProductsProperties();this.renderTable(e,"Адрес")}createProductAndRenderTable(t,e,n){this.view.hideInput(t);const r=this.view.getURL(e);this.model.createProduct({URL:r,owner:n});const i=this.model.getStartProductsProperties();this.renderTable(i,"Адрес")}}).initApp()})();